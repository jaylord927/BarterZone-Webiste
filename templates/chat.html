{% extends "base.html" %}
{% block content %}
<section class="hero-section">
  <div class="overlay" style="background: rgba(255,255,255,0.95); color:#333; max-width: 800px; width:100%; padding:20px; border-radius:10px;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="color:#0d47a1; margin: 0;">Chat with {{ partner['full_name'] or partner['username'] }}</h2>
      <a href="{{ url_for('view_messages') }}" class="btn-primary" style="background-color: #546e7a;">Back to Messages</a>
    </div>
    
    <!-- Chat Messages -->
    <div id="chatMessages" style="height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-bottom: 20px; background-color: #f9f9f9;">
      {% if messages %}
        {% for message in messages %}
        <div style="margin-bottom: 15px; display: flex; {% if message['sender_id'] == user_id %}justify-content: flex-end{% else %}justify-content: flex-start{% endif %};">
          <div style="max-width: 70%; padding: 10px 15px; border-radius: 18px; 
                      {% if message['sender_id'] == user_id %}background-color: #0d47a1; color: white;{% else %}background-color: #e0e0e0; color: #333;{% endif %}">
            <div style="font-size: 0.9em; margin-bottom: 5px; opacity: 0.8;">
              {% if message['sender_id'] == user_id %}You{% else %}{{ message['sender_full_name'] or message['sender_username'] }}{% endif %}
            </div>
            <div style="word-wrap: break-word;">{{ message['message_text'] }}</div>
            <div style="font-size: 0.8em; margin-top: 5px; opacity: 0.7; text-align: {% if message['sender_id'] == user_id %}right{% else %}left{% endif %};">
              {{ message['message_date'] }}
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div style="text-align: center; color: #666; padding: 20px;">
          No messages yet. Start the conversation!
        </div>
      {% endif %}
    </div>
    
    <!-- Send Message Form -->
    <form method="POST" action="{{ url_for('chat', partner_id=partner_id) }}" style="display: flex; gap: 10px;">
      <textarea name="message_text" placeholder="Type your message..." 
                style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical; min-height: 60px;"
                required></textarea>
      <button type="submit" class="btn-primary" style="align-self: flex-end; height: 60px;">Send</button>
    </form>

  </div>
</section>

<script>
// Scroll to bottom of chat messages
window.onload = function() {
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.scrollTop = chatMessages.scrollHeight;
};
</script>

<style>
#chatMessages::-webkit-scrollbar {
    width: 6px;
}

#chatMessages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

#chatMessages::-webkit-scrollbar-thumb {
    background: #0d47a1;
    border-radius: 3px;
}

#chatMessages::-webkit-scrollbar-thumb:hover {
    background: #0b3d91;
}
</style>
{% endblock %}